<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>发布图片</title>
<{include file="header.html"}>
<style type="text/css">
  #first_a{
  width:241px;
  border:1px solid #CCC;
}
#first_a tr:hover{
  background:#969;
}
#first_a table{
width:100%;
}
#first_a{
  display:none;
}
</style>
  <!--   <div id="cont">
        <div id="tban">
            <div id="tban_le">
                <div id="tban_le_01">
                    <img src="../../tpl/images/nlw_dqbg2.jpg" width="10" height="103" />
                </div>
                <div id="tban_le_02">
                    <h1>
                        厦门周边旅游景点
                    </h1>
                    <div id="tban_le_txt">
                        厦门周边旅游景点大全，推荐当季最佳最受欢迎的旅游景点，还有适合周末休闲的好去处。
                    </div>
                </div>
                <div id="tban_le_03">
                    <img src="../../tpl/images/nlw_dqbg4.jpg" width="10" height="103" />
                </div>
            </div>
            <div id="tban_ri">
                <div id="tban_le_01">
                    <img src="../../tpl/images/nlw_dqbg2.jpg" width="10" height="103" />
                </div>
                <div id="tban_le_02">
                    <h1>
                        推荐分类
                    </h1>
                    <div id="tban_le_txt" class="tgray1">
                        厦门周边一日游 厦门周边农家乐 厦门有什么好玩的地方
                    </div>
                </div>
                <div id="tban_le_03">
                    <img src="../../tpl/images/nlw_dqbg4.jpg" width="10" height="103" />
                </div>
            </div>
        </div>
    </div> -->
    <div style="margin-top:10px;" id="cont">
        <div id="d_tit06">
            发布照片</div>
        <div id="d_bk_t">
            <div id="d_bk_t01">
                <div class="c1">
                </div>
            </div>
            <div id="d_bk_t02">
                <div class="c1">
                </div>
            </div>
        </div>
            <div id="userinfo_bk">
              <div id="userinfo_bk2">

                <style type="text/css">
                .uploadify-button {
                  background-color: transparent;
                  border: none;
                  padding: 0;
                }
                .uploadify:hover .uploadify-button {
                  background-color: transparent;
                }
                </style>
                  
                <div id="upload" style="width:600px;margin-bottom:10px">
                  <input id="file_upload" name="file_upload" type="file" multiple>
                  <p><a href="javascript:$('#file_upload').uploadify('upload')"><img src="../../tpl/img/sendbtn.gif" width="79" height="28" alt="上传图片" /></a>&nbsp;&nbsp;<a id="ex3button" style="display:none" href="javascript:;"><img src="../../tpl/img/fbbtn.gif" width="79" height="28" alt="发布图片" /></a></p>
                  <input type="hidden" class="input-xlarge" name="type" id="type" value="<{$type}>">
                  <input type="hidden" class="input-xlarge" name="pid" id="pid" value="<{$pid}>">
                  <input type="hidden" class="input-xlarge" name="picurl" id="picurl" value="<{$picurl}>">
                </div>

                <table style="margin-bottom:10px;" id="picarray" width="420" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#d1d1d1">
                </table>

                <{if $type == "album"}>
                <table width="420" style="margin-top:10px;" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#d1d1d1">
                <{foreach item=picturesout from=$pictures key=enname}>
                    <td colspan="2" bgcolor="#FFFFFF" class="tab_right"><a target="_blank" title="<{$picturesout.title}>" href="<{spUrl}>uploadify/uploads/<{$picturesout.picurl}>"><img width="400" height="300" src="<{spUrl}>uploadify/uploads/<{$picturesout.picurl}>" /></a>
                    <{if $type == "album" }>
                    <a href="javascript:tops(<{$picturesout.id}>);">[设置封面]</a>
                    <{/if}>
                    <input type="hidden" class="input-xlarge" name="<{$picturesout.id}>" id="<{$picturesout.id}>" value="<{spUrl}>uploadify/uploads/<{$picturesout.picurl}>">
                    </td>
                <{/foreach}>
                </table>
                <{/if}>

                </div>
      </div>
   <div id="d_bk_b">
            <div id="d_bk_b01">
                <div class="c1">
                </div>
            </div>
            <div id="d_bk_b02">
                <div class="c1">
                </div>
            </div>
        </div>
    </div>
<script type="text/javascript" src="<{$domain}>/tpl/js/jquery-1.7.0.min.js"></script> 
<script src="<{$domain}>/uploadify3.2/jquery.uploadify.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="<{$domain}>/uploadify3.2/uploadify.css">
<script type="text/javascript">
    $(function() {
    var n = 0 ;
    var num = 0;
    //=======================================
    $('#file_upload').uploadify({
       'formData'     : {
                'timestamp' : '<{$timestamp}>',
                'token'     : '<{$token}>'
        },
        'auto' : false,
        'fileTypeExts' : '*.jpg',
        'buttonImage' : '<{$domain}>/uploadify3.2/browse-btn.png',
        'swf'      : '<{$domain}>/uploadify3.2/uploadify.swf',
        'uploader' : '<{$domain}>/uploadify3.2/uploadify.php',
        'cancelImg': '<{$domain}>/uploadify3.2/uploadify-cancel.png',
        'multi':true,
        'onDialogClose'  : function(queueData) {
            num = queueData.queueLength;
        },
        'onUploadSuccess':function(file, data, response){
           if((n+1) == num){
             alert("上传成功");
           }
           $('#file_upload').uploadify('upload');
           $('#ex3button').show();
           var timesing = new Date();
           var oldfile = file.name.replace(".jpg","");
           $("#picarray").append("<tr><td colspan='2' bgcolor='#FFFFFF' class='tab_right'><input type='text' name='picname"+n+"' class='tab_txt1' size='100' id='picname"+n+"' value='"+oldfile+"'><div style='margin-top:10px'><img width=400 hight=300 src='<{$domain}>/uploadify3.2/uploads/"+data+"' /></div><input type='hidden' name='picurl"+n+"' id='picurl"+n+"' value='"+data+"'><br />");
          n++;
        }
    });
 //=======================================
    $("#ex3button").click(function(){
        var newId;
      var i = 0;
      picurls = "";
      picnames = "";
      // 封面自动设置
      var tjpicurl = $('#picurl').val();
      if(tjpicurl == "default")
      { tops(id); }
      // 封面自动设置
      while (i<=n-1)
      {
          var id = 0;
          var formdata = {
             'title' : $('#picname'+i).val(),
             'types' : $('#type').val(),
             'linkid' : $('#pid').val(),
             'picurl' : $('#picurl'+i).val()
           };
              // 用$.post发送数据
           $.post('<{spUrl c=albuminfoform a=uppicdata}>', formdata, function(result){
                  //$('#resulttable').append(result);
               newId =result.match(/^\d.*$/);
               feedback(result,id,newId);
            });
        i=i+1
      }
      alert("发布成功");
      window.location.href="<{spUrl}>photoalbum.html?info=<{$type}>&pid="+$('#pid').val();
      return false;

    });

    });
   //$uploadify = jQuery.noConflict();
   function tops(id){

      var picurl = "";
      if(id != null)
      { picurl = $('#'+id).val(); }
      else
      { picurl = "<{spUrl}>uploadify/uploads/" + $('#picurl0').val();}
       
      var formdata = {
       'pid' : $('#pid').val(),
       'picurl' : picurl
      };
      $.post('<{spUrl c=albuminfoform a=topsdata}>', formdata, function(result){
            //$('#resulttable').append(result);
      if(id != null){
       if( result != 0)
        { alert("封面设置成功");}
       else
        { alert("封面设置失败");}
       }
      });
   }
</script>
<script>
    function feedback(result,id,newId){
        if(newId == null)
        {
            $('.badge').removeClass('badge badge-info').text('');
            var response = eval("("+result+")");
            var msg = "<font color='red'>错误提示！！</font><br />";
            var n = 1;
            for(var i in response){
              msg += n+"、"+response[i].toString()+"<br />";
              n++;
            }
             art.dialog({
                lock: true,
                opacity: 0.87,
                content: msg
             });
        }
        else
        {
        }
    }
</script>
<{include file="footer.html"}>